@page "/campaigns/{CampaignId:int}"
@using TabletopNote.UI.Clients
@using TabletopNote.UI.ViewModels
@inject DocumentsApiClient DocumentsApi
@inject NavigationManager NavigationManager

<!-- Side Panel -->
<MudDrawer Open="true" Elevation="1" Width="260px" ClipMode="DrawerClipMode.Never">
    <MudNavMenu Dense="true" Class="pa-2">
        <CampaignSectionNav CampaignId="@CampaignId" IsHorizontal="false" ButtonSize="Size.Medium" IconSize="Size.Medium" />
    </MudNavMenu>
</MudDrawer>

<!-- Main Content -->
<MudMainContent Class="pa-6">
    @if (Campaign == null)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    }
    else
    {
        <MudPaper Elevation="4" Class="pa-6 mx-auto"
                  Style="max-width:800px; border-radius:12px; background-color:#1E1E1E;">
            <MudStack Spacing="3">
                <MudText Typo="Typo.h3" Color="Color.Primary">
                    <MudIcon Icon="@Icons.Material.Filled.MenuBook" Class="me-2" />
                    @Campaign.CampaignName
                </MudText>

                <MudText Typo="Typo.body1" Color="Color.Secondary">
                    @Campaign.CampaignDescription
                </MudText>

                <!-- Quick Nav Buttons for small screens -->
                <MudHidden Breakpoint="Breakpoint.MdAndUp">
                    <CampaignSectionNav CampaignId="@CampaignId" IsHorizontal="true" ButtonSize="Size.Small" IconSize="Size.Small" />
                </MudHidden>
            </MudStack>
        </MudPaper>
    }
</MudMainContent>


@code {
    [Parameter]
    public int CampaignId { get; set; }

    CampaignVM Campaign { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var campaignDto = await DocumentsApi.GetCampaignById(CampaignId);

        Campaign = new CampaignVM
        {
            CampaignId = campaignDto.CampaignId,
            CampaignName = campaignDto.CampaignName,
            CampaignDescription = campaignDto.CampaignDescription,
            CampaignDocuments = campaignDto.CampaignDocuments.ToList(),
            ReferenceDocuments = campaignDto.ReferenceDocuments.ToList(),
            CalendarEvents = campaignDto.CalendarEvents.ToList()
        };
    }
}
